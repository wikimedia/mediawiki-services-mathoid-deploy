(function(t){"object"===typeof exports&&"undefined"!==typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).tassembly=t()})(function(){return function r(k,s,e){function l(a,b){if(!s[a]){if(!k[a]){var d="function"==typeof require&&require;if(!b&&d)return d(a,!0);if(q)return q(a,!0);d=Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d;}d=s[a]=
{exports:{}};k[a][0].call(d.exports,function(c){var b=k[a][1][c];return l(b?b:c)},d,d.exports,r,k,s,e)}return s[a].exports}for(var q="function"==typeof require&&require,n=0;n<e.length;n++)l(e[n]);return l}({1:[function(r,k,s){function e(a){this.protocolRegex=l}var l=RegExp("^(http://|https://|ftp://|irc://|ircs://|gopher://|telnet://|nntp://|worldwind://|mailto:|news:|svn://|git://|mms://|//)","i"),q=/&([A-Za-z0-9\x80-\xff]+);|&\#([0-9]+);|&\#[xX]([0-9A-Fa-f]+);|(&)/;e.prototype.decodeCharReferences=
function(a){var b=this;return a.replace(q,function(a,c,g,m,h){return c?b.decodeEntity(c):g?b.decodeChar(parseInt(g,10)):m?b.decodeChar(parseInt(m,16)):h})};var n=RegExp("[\t ]|\u00ad|\u1806|\u200b|\u2060|\ufeff|\u034f|\u180b|\u180c|\u180d|\u200c|\u200d|[\ufe00-\ufe0f]","g");e.prototype.cssDecodeRE=/\\(?:((?:\n|\r\n|\r|\f))|([0-9A-Fa-f]{1,6})[\x20\t\r\n\f]?|(.)|()$)/;e.prototype.sanitizeStyle=function(a){function b(a,b){var d,h;"'"===b?(d=/'/g,h=/'([^'\n\r\f]*)$/):(d=/"/g,h=/"([^"\n\r\f]*)$/);if(1===
(a.match(d)||[]).length%2)a=a.replace(h,function(a,c){return" "+c});return a}a=this.decodeCharReferences(a);a=a.replace(this.cssDecodeRE,function(a,b,d,h){var f;if(void 0!==b)return"";if(void 0!==d){a=parseInt(d,16);try{f=String.fromCharCode(a)}catch(e){f=a.toString()}}else f=void 0!==h?h:"\\";return"\n"===f||'"'===f||"'"===f||"\\"===f?"\\"+f.charCodeAt(0).toString(16)+" ":f});a=a.replace(/\/\*.*\*\//g," ");a=b(a,"'");a=b(a,'"');var d=a.indexOf("/*");0<=d&&(a=a.substr(0,d));return/[\000-\010\016-\037\177]/.test(a)?
"/* invalid control char */":/expression|filter\s*:|accelerator\s*:|url\s*\(/i.test(a)?"/* insecure input */":a};e.prototype.sanitizeHref=function(a){var b=a.match(/^((?:[a-zA-Z][^:\/]*:)?(?:\/\/)?)([^\/]+)(\/?.*)/),d,c;if(b){if(d=b[1],c=b[2],a=b[3],!d.match(this.protocolRegex))return null}else c=d="";c=c.replace(n,"");return d+c+a};k.exports={AttributeSanitizer:e}},{}],2:[function(r,k,s){function e(){this.uid=0;this.cache={};this.partials={}}function l(a){var b="",d=-1,c="";do{if(/^$|[\[:(,]/.test(c))b+=
c,/[pri]/.test(a[d+1])&&/^(?:p(?:[cm]s?)|r[mc]|i)(?:[\.\(\)}\[\]]|$)/.test(a.slice(d+1))&&(b+="c.");else if("'"===c){if(c=a.slice(d).match(/'((?:[^\\']+|\\+'?)*)'/))b+=JSON.stringify(c[1].replace(/\\'/g,"'")),d+=c[0].length-1}else b+=c;d++;c=a[d]}while(c);return b}function q(a,b,d){d=d||"";a=""+a;if(n.test(a))return a=l(a),d+a;if(/^'/.test(a))return d+JSON.stringify(a.slice(1,-1).replace(/\\'/g,"'"));if(/^[cm](?:\.[a-zA-Z_$]*)?$/.test(a))return d+a;var c;a=l(a);if(b&&"function"===typeof b.errorHandler)c=
"c.options.errorHandler(e)";else if(!b||void 0===b.errorHandler)c='(console.error("Error in " + '+JSON.stringify(a)+'+": " + e.toString()) || "")';return c?d?"try {"+d+a+";} catch (e) {"+d+c+"; }":"(function() { try {return "+a+";} catch (e) { return "+c+"; }})()":d+a}r=new (r("./AttributeSanitizer.js").AttributeSanitizer);e.prototype.attrSanitizer=r;e.prototype._getUID=function(){this.uid++;return this.uid};var n=/^(m|p(?:[cm]s?)?|r[mc]|i|c)\.([a-zA-Z_$]+)$/;e.prototype._evalExpr=function(a,b){var d=
this.cache["expr"+a];if(!d){if(d=a.match(n))return b[d[1]][d[2]];if(/^'.*'$/.test(a))return a.slice(1,-1).replace(/\\'/g,"'");d=new Function("c","var m = c.m;return "+l(a));this.cache["expr"+a]=d}if(d)try{return d(b)}catch(c){return console.error("Error while evaluating "+a),console.error(c),""}return a};e.prototype._getTemplate=function(a,b){if(Array.isArray(a))return a;/^'/.test(a)&&(a=a.slice(1,-1).replace(/\\'/g,"'"));return b.rc.options.partials[a]};e.prototype.ctlFn_foreach=function(a,b){var d=
this._evalExpr(a.data,b);if(d&&Array.isArray(d))for(var c=this.compile(this._getTemplate(a.tpl),b),g=d.length,m=this.childContext(null,b),h=0;h<g;h++)m.m=d[h],m.pms[0]=d[h],m.i=h,c(m)};e.prototype.ctlFn_template=function(a,b){var d=this._evalExpr(a.data,b),d=this.childContext(d,b),c=this._getTemplate(a.tpl,b);c&&this._render(c,d)};e.prototype.ctlFn_with=function(a,b){var d=this._evalExpr(a.data,b),c=this._getTemplate(a.tpl,b);d&&c&&(d=this.childContext(d,b),this._render(c,d))};e.prototype.ctlFn_if=
function(a,b){this._evalExpr(a.data,b)&&this._render(a.tpl,b)};e.prototype.ctlFn_ifnot=function(a,b){this._evalExpr(a.data,b)||this._render(a.tpl,b)};e.prototype.ctlFn_attr=function(a,b){var d=this,c;Object.keys(a).forEach(function(g){var m=a[g];"string"===typeof m?c=d._evalExpr(a[g],b):(c=m.v||"",m.app&&Array.isArray(m.app)&&m.app.forEach(function(a){a["if"]&&d._evalExpr(a["if"],b)&&(c+=a.v||"");a.ifnot&&!d._evalExpr(a.ifnot,b)&&(c+=a.v||"")}),!c&&null===m.v&&(c=null));c&&("href"===g||"src"===g?
c=this.attrSanitizer.sanitizeHref(c):"style"===g&&(c=this.attrSanitizer.sanitizeStyle(c)));(c||0===c||""===c)&&b.cb(" "+g+'="'+c.toString().replace(/"/g,"&quot;")+'"')})};e.prototype._xmlEncoder=function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case '"':return"&quot;";default:return"&#"+a.charCodeAt()+";"}};e.prototype.childContext=function(a,b){return{m:a,pc:b,pm:b.m,pms:[a].concat(b.ps),rm:b.rm,rc:b.rc,cb:b.cb}};e.prototype._assemble=function(a,b){function d(a){g.length&&
(c.push("cb("+g.join("+")+");"),g=[]);c.push(a)}var c=[],g=[];c.push("var val;");for(var m=a.length,e=0;e<m;e++){var f=a[e],p=f.constructor;if(p===String)g.push(JSON.stringify(f));else if(p===Array)if(p=f[0],f=f[1],"raw"===p)d(q(f,b,"val = ")+";\n"),g.push("val");else if("text"===p)d("val = "+q(f,b)+';\nval = val || val === 0 ? "" + val : "";\nif(/[<&]/.test(val)) { val = val.replace(/[<&]/g,this._xmlEncoder); }\n'),g.push("val");else if("attr"===p)for(var p=Object.keys(f),l=0;l<p.length;l++){var k=
p[l];if("string"===typeof f[k])c.push("val = "+q(f[k],b)+";");else{var n=f[k];c.push("val="+JSON.stringify(n.v||""));n.app&&Array.isArray(n.app)&&n.app.forEach(function(a){a["if"]?(c.push("if("+q(a["if"],b)+"){"),c.push("val += "+JSON.stringify(a.v||"")+";"),c.push("}")):a.ifnot&&(c.push("if(!"+q(a.ifnot,b)+"){"),c.push("val += "+JSON.stringify(a.v||"")),c.push("}"))});null===n.v&&c.push("if(!val) { val = null; }")}"href"===k||"src"===k?c.push("if (val) {val = this.attrSanitizer.sanitizeHref(val);}"):
"style"===k&&c.push("if (val) {val = this.attrSanitizer.sanitizeStyle(val);}");d('if (val || val === 0 || val === \'\') { \nval = val || val === 0 ? "" + val : "";\nif(/[<&"]/.test(val)) { val = val.replace(/[<&"]/g,this._xmlEncoder); }\ncb('+JSON.stringify(" "+k+'="')+" + val + '\"');}")}else l=this._getUID(),this.cache[l]=f,d("try {"),c.push("this["+JSON.stringify("ctlFn_"+p)+'](this.cache["'+l+'"], c);'),c.push("} catch(e) {"),c.push("console.error('Unsupported control function:', "+JSON.stringify(p)+
", e.stack);"),c.push("}");else console.error("Unsupported type:",f)}d("");return c.join("\n")};e.prototype.render=function(a,b,d){d||(d={});b={rm:b,m:b,pms:[b],rc:null,g:d.globals,cb:d.cb,options:d};b.rc=b;var c="";d.cb||(b.cb=function(a){c+=a});this._render(a,b);if(!d.cb)return c};e.prototype._render=function(a,b){if(a.__cachedFn)return a.__cachedFn(b);for(var d=a.length,c=b.cb,g=0;g<d;g++){var e=a[g],h=e.constructor;if(h===String)c(e);else if(h===Array){var h=e[0],f=e[1];if("raw"===h)c(this._evalExpr(f,
b));else if("text"===h)e=this._evalExpr(f,b),!e&&0!==e&&(e=""),c((""+e).replace(/[<&]/g,this._xmlEncoder));else try{this["ctlFn_"+h](f,b)}catch(k){console.error("Unsupported control function:",e,k)}}else console.error("Unsupported type:",e)}};e.prototype.compile=function(a,b){var d=this,c=b||{};if(a.__cachedFn)return a.__cachedFn;var e="";c.nestedTemplate?e+="var m = c.m, cb = c.cb;\n":(e=c.cb?e+"cb = options.cb;\n":e+'var res = "", cb = function(bit) { res += bit; };\n',e+="var m = c;\nc = { rc: null, rm: m, m: m, pms: [m], g: options.globals, options: options, cb: cb, nestedTemplate: true }; c.rc = c;\n");
e+=this._assemble(a,c);c.cb||(e+="return res;");var k=new Function("c","options",e),e=function(a,b){return k.call(d,a,b||c)};return a.__cachedFn=e};k.exports=new e},{"./AttributeSanitizer.js":1}]},{},[2])(2)});
